<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لغز الفنان المفقود | لعبة تحقيق تفاعلية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== RESET & VARIABLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2C3E50;
            --secondary: #E74C3C;
            --accent: #3498DB;
            --dark: #1A1A2E;
            --light: #ECF0F1;
            --success: #27AE60;
            --warning: #F39C12;
            --card-bg: rgba(255, 255, 255, 0.08);
            --glass: rgba(255, 255, 255, 0.1);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --border: rgba(255, 255, 255, 0.15);
        }

        body {
            font-family: 'Segoe UI', 'Cairo', sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
        }

        .hidden {
            display: none !important;
        }

        /* ===== LAYOUT ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== HEADER ===== */
        header {
            background: linear-gradient(90deg, var(--primary) 0%, #34495E 100%);
            padding: 1.5rem 0;
            border-bottom: 4px solid var(--accent);
            position: relative;
            overflow: hidden;
        }

        .header-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.05"><path d="M50,20 L60,40 L80,45 L65,60 L70,80 L50,70 L30,80 L35,60 L20,45 L40,40 Z"/></svg>');
            opacity: 0.1;
        }

        .header-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .logo-text h1 {
            font-size: 2.2rem;
            background: linear-gradient(45deg, #fff, var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .logo-text p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .case-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 25px;
            border-radius: 12px;
            border: 2px solid var(--accent);
            backdrop-filter: blur(10px);
        }

        .case-info h2 {
            color: var(--accent);
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .case-info p {
            color: var(--light);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* ===== GAME AREA ===== */
        .game-area {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 30px;
            margin-top: 40px;
        }

        @media (max-width: 1200px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }

        /* ===== SIDEBAR LEFT ===== */
        .sidebar-left {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* ===== CHARACTER PANEL ===== */
        .character-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
        }

        .panel-title {
            color: var(--accent);
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .character-card {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.05));
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .character-card:hover {
            transform: translateX(5px);
            border-color: var(--accent);
        }

        .character-card.suspicious {
            border-color: var(--secondary);
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.05));
        }

        .character-card.selected {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(41, 128, 185, 0.15));
            border-color: var(--accent);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .character-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .character-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            font-weight: bold;
        }

        .character-info h4 {
            font-size: 1.1rem;
            color: white;
            margin-bottom: 3px;
        }

        .character-info p {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .suspicion-level {
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        .suspicion-fill {
            height: 100%;
            background: var(--secondary);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* ===== INVENTORY ===== */
        .inventory-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .inventory-item {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--accent);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .inventory-item:hover {
            background: rgba(52, 152, 219, 0.2);
            transform: scale(1.05);
        }

        .inventory-item.collected {
            border-color: var(--success);
            background: rgba(39, 174, 96, 0.1);
        }

        .inventory-item.analyzed {
            border-color: var(--warning);
            background: rgba(243, 156, 18, 0.1);
        }

        .item-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: var(--secondary);
            border-radius: 50%;
            color: white;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }

        .scene-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .scene-title h2 {
            font-size: 1.8rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .scene-title h2 i {
            color: var(--accent);
        }

        .game-stats {
            display: flex;
            gap: 25px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            min-width: 120px;
        }

        .stat-box h3 {
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .stat-box p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        /* ===== SCENE VISUAL ===== */
        .scene-visual {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6));
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid var(--border);
            position: relative;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scene-art {
            font-size: 8rem;
            color: var(--accent);
            opacity: 0.3;
            position: absolute;
            z-index: 0;
        }

        .scene-description {
            position: relative;
            z-index: 1;
            font-size: 1.1rem;
            line-height: 1.8;
            color: white;
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .scene-description p {
            margin-bottom: 15px;
        }

        .highlight {
            color: var(--accent);
            font-weight: bold;
            background: rgba(52, 152, 219, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
        }

        /* ===== INTERACTION AREA ===== */
        .interaction-area {
            margin-top: auto;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-btn {
            padding: 18px;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(41, 128, 185, 0.1));
            border: 2px solid var(--accent);
            color: white;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, var(--accent), #2980B9);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .dialogue-box {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border-left: 5px solid var(--accent);
            display: none;
        }

        .dialogue-box.active {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dialogue-text {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 20px;
            color: white;
        }

        .dialogue-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .dialogue-option {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: right;
        }

        .dialogue-option:hover {
            background: rgba(52, 152, 219, 0.2);
            border-color: var(--accent);
            transform: translateX(-10px);
        }

        /* ===== SIDEBAR RIGHT ===== */
        .sidebar-right {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* ===== EVIDENCE LOG ===== */
        .evidence-log {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .log-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            margin-top: 15px;
        }

        .log-entry {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-right: 3px solid var(--accent);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .log-time {
            color: var(--accent);
            font-size: 0.8rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .log-text {
            color: white;
            font-size: 0.95rem;
        }

        /* ===== PUZZLE AREA ===== */
        .puzzle-area {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
        }

        .puzzle-title {
            color: var(--accent);
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .puzzle-piece {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .puzzle-piece:hover {
            background: rgba(52, 152, 219, 0.2);
            border-color: var(--accent);
        }

        .puzzle-piece.solved {
            background: rgba(39, 174, 96, 0.2);
            border-color: var(--success);
        }

        .puzzle-hint {
            background: rgba(243, 156, 18, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--warning);
            font-size: 0.9rem;
            color: white;
            margin-top: 15px;
        }

        /* ===== MODALS ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(135deg, var(--primary) 0%, #2C3E50 100%);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            border-radius: 20px;
            padding: 30px;
            border: 3px solid var(--accent);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            color: var(--accent);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .close-modal {
            background: var(--secondary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: #C0392B;
            transform: rotate(90deg);
        }

        /* ===== ANALYSIS MODAL ===== */
        .evidence-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .evidence-icon-large {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent), #2980B9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            flex-shrink: 0;
        }

        .evidence-info h4 {
            font-size: 1.4rem;
            color: white;
            margin-bottom: 10px;
        }

        .evidence-info p {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
        }

        .analysis-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .analysis-option {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .analysis-option:hover {
            background: rgba(52, 152, 219, 0.2);
            border-color: var(--accent);
            transform: translateY(-5px);
        }

        .analysis-option i {
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .analysis-option h5 {
            color: white;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .analysis-option p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .analysis-result {
            background: rgba(0, 0, 0, 0.4);
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
            border-left: 5px solid var(--accent);
            display: none;
        }

        .analysis-result.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        /* ===== FINAL REPORT MODAL ===== */
        .report-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .report-section h4 {
            color: var(--accent);
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .conclusion-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .conclusion-option {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            text-align: center;
        }

        .conclusion-option:hover {
            transform: scale(1.05);
        }

        .conclusion-option.selected {
            border-color: var(--accent);
            background: rgba(52, 152, 219, 0.2);
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
        }

        .conclusion-option h5 {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .conclusion-option p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .submit-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--success), #229954);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, #229954, var(--success));
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4);
        }

        /* ===== RESULTS MODAL ===== */
        .results-content {
            text-align: center;
        }

        .result-icon {
            font-size: 5rem;
            color: var(--accent);
            margin: 20px 0;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }

        .result-title {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 20px;
            background: linear-gradient(45deg, var(--accent), #9B59B6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .result-details {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: right;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .score-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
        }

        .score-item h5 {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .score-value {
            font-size: 2rem;
            color: var(--accent);
            font-weight: bold;
        }

        .restart-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), #34495E);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .restart-btn:hover {
            background: linear-gradient(135deg, #34495E, var(--primary));
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(44, 62, 80, 0.4);
        }

        /* ===== NOTIFICATION ===== */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--accent), #2980B9);
            color: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 100;
            transform: translateX(500px);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification i {
            font-size: 1.5rem;
        }

        .notification-text {
            font-weight: 600;
        }

        /* ===== LOADING ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(52, 152, 219, 0.2);
            border-top: 8px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 30px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--accent);
            text-align: center;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #2980B9;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .game-stats {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .stat-box {
                min-width: 100px;
                padding: 12px 20px;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .conclusion-options {
                grid-template-columns: 1fr;
            }
            
            .score-breakdown {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">جاري تحميل لغز الفنان المفقود<span class="loading-dots"></span></div>
    </div>

    <!-- Header -->
    <header>
        <div class="header-bg"></div>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <div class="logo-text">
                        <h1>لغز الفنان المفقود</h1>
                        <p>لعبة تحقيق تفاعلية - هل تستطيع حل اللغز؟</p>
                    </div>
                </div>
                <div class="case-info">
                    <h2>القضية: اختفاء الرسام الشهير</h2>
                    <p>المكان: استوديو الفنان | الوقت: 72 ساعة منذ الاختفاء</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Game Area -->
    <div class="container">
        <div class="game-area">
            <!-- Left Sidebar: Characters & Inventory -->
            <aside class="sidebar-left">
                <!-- Characters Panel -->
                <div class="character-panel">
                    <h3 class="panel-title">
                        <i class="fas fa-users"></i>
                        المشتبه بهم
                    </h3>
                    <div id="charactersList">
                        <!-- Characters will be added dynamically -->
                    </div>
                </div>

                <!-- Inventory Panel -->
                <div class="inventory-panel">
                    <h3 class="panel-title">
                        <i class="fas fa-briefcase"></i>
                        الأدلة المجمعة
                    </h3>
                    <div class="inventory-grid" id="inventoryGrid">
                        <!-- Inventory items will be added dynamically -->
                    </div>
                </div>
            </aside>

            <!-- Main Content: Scene & Interactions -->
            <main class="main-content">
                <!-- Scene Header -->
                <div class="scene-header">
                    <div class="scene-title">
                        <h2><i class="fas fa-search"></i> مسرح الجريمة: استوديو الفنان</h2>
                    </div>
                    <div class="game-stats">
                        <div class="stat-box">
                            <h3 id="timeLeft">72:00</h3>
                            <p>ساعة متبقية</p>
                        </div>
                        <div class="stat-box">
                            <h3 id="evidenceCount">0/12</h3>
                            <p>أدلة مجمعة</p>
                        </div>
                        <div class="stat-box">
                            <h3 id="suspicionLevel">0%</h3>
                            <p>مستوى الشك</p>
                        </div>
                    </div>
                </div>

                <!-- Scene Visual -->
                <div class="scene-visual">
                    <div class="scene-art">
                        <i class="fas fa-paint-brush"></i>
                    </div>
                    <div class="scene-description" id="sceneDescription">
                        <p>استوديو الفنان <span class="highlight">ليث الناصر</span> (45 سنة) في الطابق العلوي من مبنى قديم بحي الفنون.</p>
                        <p>اختفى الفنان منذ <span class="highlight">3 أيام</span> قبل معرضه الكبير المقرر بعد أسبوع.</p>
                        <p>الباب كان مقفلاً من الداخل، والنافذة المكسورة هي الدليل الوحيد على وجود اقتحام.</p>
                        <p>اللوحة الأخيرة التي كان يعمل عليها <span class="highlight">مختفية</span>، لكن بقية الاستوديو تبدو طبيعية.</p>
                    </div>
                </div>

                <!-- Interaction Area -->
                <div class="interaction-area">
                    <div class="action-buttons" id="actionButtons">
                        <!-- Action buttons will be added dynamically -->
                    </div>
                    <div class="dialogue-box" id="dialogueBox">
                        <div class="dialogue-text" id="dialogueText"></div>
                        <div class="dialogue-options" id="dialogueOptions"></div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar: Evidence Log & Puzzles -->
            <aside class="sidebar-right">
                <!-- Evidence Log -->
                <div class="evidence-log">
                    <h3 class="panel-title">
                        <i class="fas fa-clipboard-list"></i>
                        سجل التحقيق
                    </h3>
                    <div class="log-content" id="evidenceLog">
                        <!-- Log entries will be added dynamically -->
                    </div>
                </div>

                <!-- Puzzle Area -->
                <div class="puzzle-area">
                    <h3 class="puzzle-title">
                        <i class="fas fa-puzzle-piece"></i>
                        اللغز الحالي
                    </h3>
                    <div class="puzzle-grid" id="puzzleGrid">
                        <!-- Puzzle pieces will be added dynamically -->
                    </div>
                    <div class="puzzle-hint" id="puzzleHint">
                        جمع الأدلة لحل اللغز
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Evidence Analysis Modal -->
    <div id="analysisModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-microscope"></i>
                    تحليل الدليل
                </h3>
                <button class="close-modal" onclick="closeAnalysis()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="analysisModalContent">
                <!-- Content will be added dynamically -->
            </div>
        </div>
    </div>

    <!-- Final Report Modal -->
    <div id="reportModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-file-alt"></i>
                    التقرير النهائي
                </h3>
                <button class="close-modal" onclick="closeReport()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="reportModalContent">
                <!-- Content will be added dynamically -->
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div id="resultsModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div id="resultsModalContent">
                <!-- Content will be added dynamically -->
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification hidden">
        <i class="fas fa-check-circle"></i>
        <div class="notification-text" id="notificationText"></div>
    </div>

    <script>
        // ===== GAME STATE =====
        const gameState = {
            timeLeft: 4320, // 72 hours in minutes
            collectedEvidence: [],
            analyzedEvidence: [],
            interviewedCharacters: [],
            discoveredClues: [],
            suspicionLevels: {},
            currentCharacter: null,
            currentEvidence: null,
            gameProgress: 0,
            score: 0,
            gameActive: true,
            timerInterval: null
        };

        // ===== GAME DATA =====
        const gameData = {
            characters: [
                {
                    id: 1,
                    name: "سارة",
                    role: "مساعدة الاستوديو",
                    avatar: "س",
                    color: "#9B59B6",
                    suspicion: 25,
                    statement: "آخر مرة رأيت فيها ليث كانت قبل اختفائه بيوم. كان متوتراً بشأن المعرض.",
                    clues: [
                        "تعرف كلمة سر الكمبيوتر",
                        "لها مفتاح احتياطي للاستوديو",
                        "كانت آخر شخص يراه قبل الاختفاء"
                    ],
                    dialogue: {
                        greeting: "أتمنى أن تجدوا ليث. كان مثل الأب لي.",
                        questions: [
                            {
                                text: "ماذا كان يعمل ليث قبل اختفائه؟",
                                answer: "كان منهمكاً في اللوحة الأخيرة. قال أنها ستغير كل شيء.",
                                revealsClue: "اللوحة كانت تظهر شيئاً خطيراً عن أحد الممولين."
                            },
                            {
                                text: "هل لاحظت أي شيء غريب؟",
                                answer: "سمعت صوت شجار ليلة الاختفاء، لكن اعتقدت أنه التلفاز.",
                                revealsClue: "الصوت جاء من الاستوديو، ليس الشقة."
                            },
                            {
                                text: "من يعرف كلمة سر الكمبيوتر؟",
                                answer: "أنا وليث فقط. لكن... ربما كان يشاركها مع زبون مهم.",
                                revealsClue: "الممول الكبير كان يزوره كثيراً في الفترة الأخيرة."
                            }
                        ]
                    },
                    isGuilty: false
                },
                {
                    id: 2,
                    name: "خالد",
                    role: "ممول المعرض",
                    avatar: "خ",
                    color: "#E74C3C",
                    suspicion: 65,
                    statement: "استثمرت مبلغاً كبيراً في المعرض. اختفاؤه خسارة لي أيضاً.",
                    clues: [
                        "كان يهدد بسحب التمويل",
                        "له سوابق في الاحتيال الفني",
                        "شوهد قرب الاستوديو ليلة الاختفاء"
                    ],
                    dialogue: {
                        greeting: "أنا قلق على استثماري. المعرض يجب أن يستمر.",
                        questions: [
                            {
                                text: "ما طبيعة علاقتك بليث؟",
                                answer: "علاقة عمل فقط. هو الموهبة، وأنا المال.",
                                revealsClue: "كانت هناك رسائل تهديد منه قبل أسبوع."
                            },
                            {
                                text: "أين كنت ليلة الاختفاء؟",
                                answer: "في اجتماع خارج المدينة. يمكنني تقديم شهود.",
                                revealsClue: "تذاكر السفر قد تكون مزورة."
                            },
                            {
                                text: "لماذا تهدد بسحب التمويل؟",
                                answer: "لأن اللوحات كانت تتأخر. لكن هذا ليس جريمة!",
                                revealsClue: "التهديد كان لأن ليث اكتشف شيئاً عنه."
                            }
                        ]
                    },
                    isGuilty: true
                },
                {
                    id: 3,
                    name: "نادية",
                    role: "ناقدة فنية",
                    avatar: "ن",
                    color: "#3498DB",
                    suspicion: 40,
                    statement: "ليث كان عبقرياً. اختفاؤه مأساة للفن.",
                    clues: [
                        "كانت تنتقد لوحاته الأخيرة بشدة",
                        "لها كتاب غير منشور عن فضائح الفنانين",
                        "عثر على قلمها في الاستوديو"
                    ],
                    dialogue: {
                        greeting: "الفن فقد نجماً ساطعاً. لكن لكل شيء نهاية.",
                        questions: [
                            {
                                text: "ما رأيك في لوحاته الأخيرة؟",
                                answer: "كانت جريئة جداً. تكشف الحقائق المؤلمة.",
                                revealsClue: "اللوحة الأخيرة كانت تكشف علاقة غير قانونية."
                            },
                            {
                                text: "لماذا كان قلمك في الاستوديو؟",
                                answer: "زرته قبل أيام لمناقشة المعرض. ربما نسيت القلم.",
                                revealsClue: "تاريخ الزيارة يتعارض مع سفرها المزعوم."
                            },
                            {
                                text: "ما موضوع كتابك غير المنشور؟",
                                answer: "أسرار الفنانين. ولكن... بعض الأسرار تبقى سراً.",
                                revealsClue: "الفصل الأخير يتحدث عن "ممول يختفي فنانين"."
                            }
                        ]
                    },
                    isGuilty: false
                }
            ],

            evidence: [
                {
                    id: 1,
                    name: "النافذة المكسورة",
                    icon: "fas fa-window-maximize",
                    location: "الجدار الشرقي",
                    description: "نافذة مكسورة من الداخل إلى الخارج، زجاج على الأرض الخارجية.",
                    analysis: {
                        options: [
                            {
                                name: "فحص البصمات",
                                icon: "fas fa-fingerprint",
                                result: "لا توجد بصمات على الإطار. تم مسحها.",
                                points: 20
                            },
                            {
                                name: "تحليل اتجاه الكسر",
                                icon: "fas fa-search",
                                result: "الكسر من الداخل، ليس اقتحاماً من الخارج.",
                                points: 30
                            },
                            {
                                name: "فحص بقايا الزجاج",
                                icon: "fas fa-vial",
                                result: "عثر على ألياف قفاز لاتكس في الزجاج.",
                                points: 25
                            }
                        ],
                        conclusion: "النافذة كسرت من الداخل لتمويه الجريمة على أنها اقتحام."
                    }
                },
                {
                    id: 2,
                    name: "اللوحة الناقصة",
                    icon: "fas fa-paint-brush",
                    location: "حامل الرسم",
                    description: "حامل لوحة فارغ، بقع ألوان حديثة، لكن اللوحة مفقودة.",
                    analysis: {
                        options: [
                            {
                                name: "تحليل بقع الألوان",
                                icon: "fas fa-palette",
                                result: "الألوان حديثة (أقل من 48 ساعة). تحتوي على دم مجهري.",
                                points: 35
                            },
                            {
                                name: "فحص الحامل",
                                icon: "fas fa-expand",
                                result: "آثار خدوش تشير إلى نزع اللوحة بعنف.",
                                points: 20
                            },
                            {
                                name: "الأشعة فوق البنفسجية",
                                icon: "fas fa-sun",
                                result: "كشف عن رسالة مخفية: 'الحقيقة ستظهر'.",
                                points: 40
                            }
                        ],
                        conclusion: "اللوحة كانت تكشف سراً ما، وتم تدميرها."
                    }
                },
                {
                    id: 3,
                    name: "الكمبيوتر",
                    icon: "fas fa-laptop",
                    location: "المكتب",
                    description: "كمبيوتر محمول، كلمة السر مفعلة، آخر دخول قبل 3 أيام.",
                    analysis: {
                        options: [
                            {
                                name: "فحص سجل التصفح",
                                icon: "fas fa-history",
                                result: "بحث عن 'كيفية اختراق كاميرات المراقبة'.",
                                points: 30
                            },
                            {
                                name: "الرسائل المحذوفة",
                                icon: "fas fa-trash-restore",
                                result: "استعادة رسالة تهديد: 'ستندم إذا كشفت السر'.",
                                points: 45
                            },
                            {
                                name: "سجل الملفات",
                                icon: "fas fa-file",
                                result: "ملف باسم 'الحقيقة.mp4' محذوف قبل الاختفاء.",
                                points: 35
                            }
                        ],
                        conclusion: "كان الفنان يتعرض للتهديد بسبب شيء اكتشفه."
                    }
                },
                {
                    id: 4,
                    name: "الهاتف",
                    icon: "fas fa-mobile-alt",
                    location: "تحت المكتب",
                    description: "هاتف محطم، الشاشة مكسورة، بطارية مفقودة.",
                    analysis: {
                        options: [
                            {
                                name: "فحص الرقاقة",
                                icon: "fas fa-sim-card",
                                result: "آخر مكالمة: من رقم مجهول (مدة 2 دقيقة).",
                                points: 25
                            },
                            {
                                name: "الرسائل النصية",
                                icon: "fas fa-sms",
                                result: "رسالة: 'اللقاء في الاستوديو 10 مساءً. تأتي وحدك'.",
                                points: 35
                            },
                            {
                                name: "تحديد الموقع",
                                icon: "fas fa-map-marker-alt",
                                result: "آخر موقع: الاستوديو. لم يتحرك بعده.",
                                points: 20
                            }
                        ],
                        conclusion: "تمت دعوة الفنان للقاء ثم تعرض للهجوم."
                    }
                }
            ],

            puzzles: [
                {
                    id: 1,
                    title: "شفرة اللوحة",
                    description: "فك شفرة الألوان المخفية في اللوحة",
                    pieces: ["🔴", "🔵", "🟢", "🟡", "🟣", "⚫"],
                    solution: ["🔴", "🔵", "🟢", "🟡", "🟣", "⚫"],
                    hint: "الترتيب حسب عجلة الألوان",
                    points: 50
                },
                {
                    id: 2,
                    title: "الجدول الزمني",
                    description: "رتب الأحداث بالترتيب الصحيح",
                    pieces: ["📞 مكالمة", "🖼️ لوحة", "👥 لقاء", "💥 اختفاء"],
                    solution: ["🖼️ لوحة", "📞 مكالمة", "👥 لقاء", "💥 اختفاء"],
                    hint: "ابدأ باللوحة وانتهي بالاختفاء",
                    points: 60
                }
            ]
        };

        // ===== DOM ELEMENTS =====
        const elements = {
            loadingScreen: document.getElementById('loadingScreen'),
            charactersList: document.getElementById('charactersList'),
            inventoryGrid: document.getElementById('inventoryGrid'),
            timeLeft: document.getElementById('timeLeft'),
            evidenceCount: document.getElementById('evidenceCount'),
            suspicionLevel: document.getElementById('suspicionLevel'),
            sceneDescription: document.getElementById('sceneDescription'),
            actionButtons: document.getElementById('actionButtons'),
            dialogueBox: document.getElementById('dialogueBox'),
            dialogueText: document.getElementById('dialogueText'),
            dialogueOptions: document.getElementById('dialogueOptions'),
            evidenceLog: document.getElementById('evidenceLog'),
            puzzleGrid: document.getElementById('puzzleGrid'),
            puzzleHint: document.getElementById('puzzleHint'),
            analysisModal: document.getElementById('analysisModal'),
            analysisModalContent: document.getElementById('analysisModalContent'),
            reportModal: document.getElementById('reportModal'),
            reportModalContent: document.getElementById('reportModalContent'),
            resultsModal: document.getElementById('resultsModal'),
            resultsModalContent: document.getElementById('resultsModalContent'),
            notification: document.getElementById('notification'),
            notificationText: document.getElementById('notificationText')
        };

        // ===== GAME INITIALIZATION =====
        function initGame() {
            // Simulate loading
            setTimeout(() => {
                elements.loadingScreen.classList.add('hidden');
                renderCharacters();
                renderEvidence();
                renderPuzzle();
                startTimer();
                updateStats();
                addLogEntry("بدأ التحقيق في اختفاء الفنان ليث الناصر");
                showNotification("مرحباً أيها المحقق! هل تستطيع حل اللغز؟");
            }, 2000);
        }

        // ===== RENDER FUNCTIONS =====
        function renderCharacters() {
            elements.charactersList.innerHTML = '';
            gameData.characters.forEach(character => {
                const div = document.createElement('div');
                div.className = `character-card ${gameState.suspicionLevels[character.id] > 50 ? 'suspicious' : ''}`;
                div.innerHTML = `
                    <div class="character-header">
                        <div class="character-avatar" style="background: ${character.color}">
                            ${character.avatar}
                        </div>
                        <div class="character-info">
                            <h4>${character.name}</h4>
                            <p>${character.role}</p>
                        </div>
                    </div>
                    <div class="suspicion-level">
                        <div class="suspicion-fill" style="width: ${character.suspicion}%"></div>
                    </div>
                `;
                div.onclick = () => selectCharacter(character);
                elements.charactersList.appendChild(div);
            });
        }

        function renderEvidence() {
            elements.inventoryGrid.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const div = document.createElement('div');
                div.className = 'inventory-item';
                
                if (i < gameData.evidence.length) {
                    const evidence = gameData.evidence[i];
                    div.innerHTML = `
                        <i class="${evidence.icon}"></i>
                        ${gameState.collectedEvidence.includes(evidence.id) ? '<div class="item-badge">✓</div>' : ''}
                    `;
                    div.classList.toggle('collected', gameState.collectedEvidence.includes(evidence.id));
                    div.classList.toggle('analyzed', gameState.analyzedEvidence.includes(evidence.id));
                    div.onclick = () => analyzeEvidence(evidence);
                } else {
                    div.innerHTML = '<i class="fas fa-question"></i>';
                }
                elements.inventoryGrid.appendChild(div);
            }
        }

        function renderPuzzle() {
            elements.puzzleGrid.innerHTML = '';
            const puzzle = gameData.puzzles[0];
            puzzle.pieces.forEach((piece, index) => {
                const div = document.createElement('div');
                div.className = 'puzzle-piece';
                div.textContent = piece;
                div.onclick = () => solvePuzzlePiece(index);
                elements.puzzleGrid.appendChild(div);
            });
        }

        // ===== GAME FUNCTIONS =====
        function selectCharacter(character) {
            gameState.currentCharacter = character;
            
            // Update UI
            document.querySelectorAll('.character-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Show dialogue
            showDialogue(character);
        }

        function showDialogue(character) {
            elements.dialogueBox.classList.add('active');
            elements.dialogueText.textContent = character.dialogue.greeting;
            
            elements.dialogueOptions.innerHTML = '';
            character.dialogue.questions.forEach((question, index) => {
                const div = document.createElement('div');
                div.className = 'dialogue-option';
                div.textContent = question.text;
                div.onclick = () => askQuestion(character, index);
                elements.dialogueOptions.appendChild(div);
            });
            
            // Add close button
            const closeDiv = document.createElement('div');
            closeDiv.className = 'dialogue-option';
            closeDiv.innerHTML = '<i class="fas fa-times"></i> إنهاء المحادثة';
            closeDiv.onclick = () => elements.dialogueBox.classList.remove('active');
            elements.dialogueOptions.appendChild(closeDiv);
        }

        function askQuestion(character, questionIndex) {
            const question = character.dialogue.questions[questionIndex];
            elements.dialogueText.textContent = question.answer;
            
            if (question.revealsClue && !gameState.discoveredClues.includes(`${character.id}-${questionIndex}`)) {
                gameState.discoveredClues.push(`${character.id}-${questionIndex}`);
                gameState.score += 15;
                addLogEntry(`اكتشفت دليلاً جديداً: ${question.revealsClue}`);
                showNotification("🔍 اكتشفت دليلاً جديداً!");
                updateStats();
            }
        }

        function analyzeEvidence(evidence) {
            if (!gameState.collectedEvidence.includes(evidence.id)) {
                // Collect evidence first
                gameState.collectedEvidence.push(evidence.id);
                gameState.score += 10;
                addLogEntry(`جمعت دليل: ${evidence.name}`);
                showNotification("📦 جمعت دليلاً جديداً!");
                renderEvidence();
                updateStats();
                return;
            }
            
            gameState.currentEvidence = evidence;
            elements.analysisModalContent.innerHTML = `
                <div class="evidence-display">
                    <div class="evidence-icon-large">
                        <i class="${evidence.icon}"></i>
                    </div>
                    <div class="evidence-info">
                        <h4>${evidence.name}</h4>
                        <p>${evidence.description}</p>
                        <p><strong>المكان:</strong> ${evidence.location}</p>
                    </div>
                </div>
                
                <div class="analysis-options">
                    ${evidence.analysis.options.map((option, index) => `
                        <div class="analysis-option" onclick="performAnalysis(${index})">
                            <i class="${option.icon}"></i>
                            <h5>${option.name}</h5>
                            <p>${option.points} نقطة</p>
                        </div>
                    `).join('')}
                </div>
                
                <div class="analysis-result" id="analysisResult"></div>
            `;
            
            elements.analysisModal.classList.remove('hidden');
        }

        function performAnalysis(optionIndex) {
            const evidence = gameState.currentEvidence;
            const option = evidence.analysis.options[optionIndex];
            
            document.getElementById('analysisResult').innerHTML = `
                <h5><i class="fas fa-check-circle"></i> نتيجة التحليل</h5>
                <p>${option.result}</p>
                <p><strong>النقاط المكتسبة:</strong> ${option.points}</p>
                ${!gameState.analyzedEvidence.includes(evidence.id) ? `
                    <button onclick="completeAnalysis()" style="
                        background: var(--accent);
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 8px;
                        cursor: pointer;
                        margin-top: 15px;
                        font-weight: bold;
                    ">
                        <i class="fas fa-check"></i> تسجيل التحليل
                    </button>
                ` : ''}
            `;
            document.getElementById('analysisResult').classList.add('show');
            
            if (!gameState.analyzedEvidence.includes(evidence.id)) {
                gameState.score += option.points;
                updateStats();
            }
        }

        function completeAnalysis() {
            const evidence = gameState.currentEvidence;
            if (!gameState.analyzedEvidence.includes(evidence.id)) {
                gameState.analyzedEvidence.push(evidence.id);
                addLogEntry(`حللت دليل: ${evidence.name}`);
                showNotification("🔬 اكتمل تحليل الدليل!");
                renderEvidence();
                updateStats();
                
                // Check if all evidence analyzed
                if (gameState.analyzedEvidence.length === gameData.evidence.length) {
                    showFinalReport();
                }
            }
        }

        function solvePuzzlePiece(index) {
            const pieces = document.querySelectorAll('.puzzle-piece');
            pieces[index].classList.add('solved');
            
            // Check if puzzle solved
            const solvedPieces = document.querySelectorAll('.puzzle-piece.solved').length;
            if (solvedPieces === gameData.puzzles[0].pieces.length) {
                gameState.score += gameData.puzzles[0].points;
                addLogEntry("🧩 حللت اللغز!");
                showNotification("✨ أحسنت! حللت اللغز!");
                updateStats();
                elements.puzzleHint.textContent = "أحسنت! اللغز محلول.";
            }
        }

        function showFinalReport() {
            elements.reportModalContent.innerHTML = `
                <div class="report-section">
                    <h4><i class="fas fa-clipboard-check"></i> ملخص الأدلة</h4>
                    <p>جمعت ${gameState.collectedEvidence.length} من أصل ${gameData.evidence.length} أدلة</p>
                    <p>حللت ${gameState.analyzedEvidence.length} أدلة</p>
                    <p>اكتشفت ${gameState.discoveredClues.length} دليلاً</p>
                </div>
                
                <div class="report-section">
                    <h4><i class="fas fa-user-secret"></i> المشتبه الرئيسي</h4>
                    <p>بناءً على تحليلك، من تعتقد أنه المسؤول؟</p>
                    
                    <div class="conclusion-options">
                        ${gameData.characters.map(character => `
                            <div class="conclusion-option" onclick="selectConclusion(${character.id})" id="conclusion-${character.id}">
                                <h5>${character.name}</h5>
                                <p>${character.role}</p>
                                <p>مستوى الشك: ${character.suspicion}%</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <button class="submit-btn" id="submitReport" onclick="submitReport()" disabled>
                    <i class="fas fa-paper-plane"></i> تقديم التقرير النهائي
                </button>
            `;
            
            elements.reportModal.classList.remove('hidden');
        }

        function selectConclusion(characterId) {
            document.querySelectorAll('.conclusion-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById(`conclusion-${characterId}`).classList.add('selected');
            document.getElementById('submitReport').disabled = false;
            gameState.currentCharacter = gameData.characters.find(c => c.id === characterId);
        }

        function submitReport() {
            const isCorrect = gameState.currentCharacter.isGuilty;
            
            elements.resultsModalContent.innerHTML = `
                <div class="results-content">
                    <div class="result-icon">
                        <i class="fas fa-${isCorrect ? 'trophy' : 'times-circle'}"></i>
                    </div>
                    
                    <h1 class="result-title">
                        ${isCorrect ? '🎉 أحسنت! 🎉' : '❌ للأسف! ❌'}
                    </h1>
                    
                    <div class="result-details">
                        <p>${isCorrect ? 
                            'أحسنت! كشفت الجاني الحقيقي. خالد الممول هو من خطط للجريمة بعد أن اكتشف الفنان تورطه في عمليات احتيال.' : 
                            'آسف، اختيارك خاطئ. الجاني الحقيقي هو خالد الممول الذي اختطف الفنان بعد أن هدده بكشف أسراره.'}</p>
                    </div>
                    
                    <div class="score-breakdown">
                        <div class="score-item">
                            <h5>الأدلة المجمعة</h5>
                            <div class="score-value">${gameState.collectedEvidence.length}</div>
                        </div>
                        <div class="score-item">
                            <h5>الأدلة المحللة</h5>
                            <div class="score-value">${gameState.analyzedEvidence.length}</div>
                        </div>
                        <div class="score-item">
                            <h5>النقاط الإجمالية</h5>
                            <div class="score-value">${gameState.score}</div>
                        </div>
                    </div>
                    
                    <button class="restart-btn" onclick="restartGame()">
                        <i class="fas fa-redo"></i> لعب مرة أخرى
                    </button>
                </div>
            `;
            
            elements.reportModal.classList.add('hidden');
            elements.resultsModal.classList.remove('hidden');
        }

        function restartGame() {
            // Reset game state
            gameState.timeLeft = 4320;
            gameState.collectedEvidence = [];
            gameState.analyzedEvidence = [];
            gameState.interviewedCharacters = [];
            gameState.discoveredClues = [];
            gameState.suspicionLevels = {};
            gameState.currentCharacter = null;
            gameState.currentEvidence = null;
            gameState.gameProgress = 0;
            gameState.score = 0;
            gameState.gameActive = true;
            
            // Reset UI
            elements.resultsModal.classList.add('hidden');
            elements.loadingScreen.classList.remove('hidden');
            
            // Reinitialize game
            setTimeout(() => {
                elements.loadingScreen.classList.add('hidden');
                renderCharacters();
                renderEvidence();
                renderPuzzle();
                startTimer();
                updateStats();
                addLogEntry("بدأ التحقيق من جديد");
                showNotification("حظاً موفقاً في هذه المرة!");
            }, 1500);
        }

        // ===== UTILITY FUNCTIONS =====
        function startTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timerInterval = setInterval(() => {
                if (gameState.timeLeft > 0 && gameState.gameActive) {
                    gameState.timeLeft--;
                    updateStats();
                } else if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timerInterval);
                    showNotification("⏰ انتهى الوقت! قدم تقريرك النهائي.");
                }
            }, 1000); // 1 second per minute (for faster gameplay)
        }

        function updateStats() {
            // Update time
            const hours = Math.floor(gameState.timeLeft / 60);
            const minutes = gameState.timeLeft % 60;
            elements.timeLeft.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            
            // Update evidence count
            elements.evidenceCount.textContent = `${gameState.collectedEvidence.length}/${gameData.evidence.length}`;
            
            // Update suspicion level
            const avgSuspicion = gameData.characters.reduce((sum, c) => sum + c.suspicion, 0) / gameData.characters.length;
            elements.suspicionLevel.textContent = `${Math.round(avgSuspicion)}%`;
            
            // Update game progress
            gameState.gameProgress = Math.round(
                ((gameState.collectedEvidence.length + gameState.analyzedEvidence.length + gameState.discoveredClues.length) /
                (gameData.evidence.length * 2 + gameData.characters.length * 3)) * 100
            );
        }

        function addLogEntry(text) {
            const now = new Date();
            const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <div class="log-time">
                    <i class="far fa-clock"></i> ${time}
                </div>
                <div class="log-text">${text}</div>
            `;
            
            elements.evidenceLog.prepend(entry);
            
            // Limit log entries
            const entries = elements.evidenceLog.querySelectorAll('.log-entry');
            if (entries.length > 10) {
                entries[entries.length - 1].remove();
            }
        }

        function showNotification(text) {
            elements.notificationText.textContent = text;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }

        function closeAnalysis() {
            elements.analysisModal.classList.add('hidden');
        }

        function closeReport() {
            elements.reportModal.classList.add('hidden');
        }

        // ===== ACTION BUTTONS =====
        function setupActionButtons() {
            const actions = [
                {
                    text: "🔍 فحص الاستوديو",
                    icon: "fas fa-search",
                    action: () => {
                        addLogEntry("فحصت الاستوديو: وجدت أدلة جديدة");
                        showNotification("🔎 فحصت الاستوديو ووجدت أدلة");
                    }
                },
                {
                    text: "👥 مقابلة المشتبهين",
                    icon: "fas fa-comments",
                    action: () => {
                        showNotification("💬 تحدث مع المشتبهين من القائمة اليسرى");
                    }
                },
                {
                    text: "🔬 تحليل الأدلة",
                    icon: "fas fa-microscope",
                    action: () => {
                        showNotification("⚗️ انقر على الأدلة في الحقيبة لتحليلها");
                    }
                },
                {
                    text: "📋 التقرير النهائي",
                    icon: "fas fa-file-alt",
                    action: showFinalReport
                }
            ];
            
            elements.actionButtons.innerHTML = '';
            actions.forEach(action => {
                const button = document.createElement('button');
                button.className = 'action-btn';
                button.innerHTML = `<i class="${action.icon}"></i> ${action.text}`;
                button.onclick = action.action;
                elements.actionButtons.appendChild(button);
            });
        }

        // ===== INITIALIZE =====
        window.onload = function() {
            initGame();
            setupActionButtons();
            
            // Make functions globally available
            window.closeAnalysis = closeAnalysis;
            window.closeReport = closeReport;
            window.performAnalysis = performAnalysis;
            window.completeAnalysis = completeAnalysis;
            window.selectConclusion = selectConclusion;
            window.submitReport = submitReport;
            window.restartGame = restartGame;
        };
    </script>
</body>
</html>
